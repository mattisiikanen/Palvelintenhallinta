# h5 Vaihtoehdot

## Lukuläksy
Tällä kertaa lukuläksynä tuli lukea ja tiivistää kaksi artikkelia Windowsin hallinnasta Saltin avulla. Ensimmäinen oli Tero Karvisen luoma ohjeistus "Control Windows with Salt" ja toinen oli vapaavalintainen Internetin syövereistä, löysin P Seppäsen ohjeistuksen aiheesta otsikolla "Harjoitus 5, Linux-master meets Windows-slave".

Control Windows with Salt:
- Aiheena kuinka koneelle ajetaan ohjelmia sekä Powershell komentoja
- Pitkä ja muistista kirjoitettu testaamaton teksti
- 2 Windows orjakonetta käytetään
- Windows koneiden vaiheittainen käyttöönotto
- Saltia voidaan ajaa paikallisesti Windowsissa
- Chocolateyn asennus ja hallinta
- Windows roolien asennuksessa tulee olla tarkkana Windowsin versiosta
- Saltilla voidaan hallita sekä Windowsin työpöytä että palvelin versioita

Linux-master meets Windows-slave
- Harjoituksessa testataan Linux master koneella hallita Windows orjakonetta
- Alussa Windows koneelle asennetaan Salt-Minion paketti, johon myös määritellään erikseen isäntäkoneen tiedot
- Konfiguroinnin jälkeen testataan Saltia paikallisesti Windows-koneella
- Paikallisen testauksen jälkeen siirrytään muuttamaan asetuksia Windows koneelle Linux herran avulla

## Ympäristö

Host:

- CPU: i5-13600K
- RAM: 32b
- HDD: 120Gb
- Win 11 Pro x64

## Aloitus 
H5:n tehtävien tarkoituksena oli käsitellä testata Saltin toimintaa Windows koneilla paikallisesti sekä herra-orja arkkitehtuurin avulla. Aloitin tehtävät 26.4.2023 klo 17:28 luomalla uuden virtuaalikoneen VirtualBoxiin, minulta nimittäin löytyi entuudestaan Windows 11 image ladattuna. Käytin kyseistä imagea tässä harjoituksessa. Loin virtuaalikoneen seuraavilla määritteillä: </br>

![Kuva1](https://user-images.githubusercontent.com/122887740/234610368-3f33985b-141e-4298-9d2d-9a67c04ae6ea.png)</br>

Windowsin asennus alkoi painamalla ihan mitä vain näppäintä koneen käynnistyessä, loput menivät automatiikalla, koska VM:ää luodessa oli jätetty pois päältä kohta "Skip Unattended Install". Windows koneen pystytys ja asennus kesti n. 20 min. Asennuksen jälkeen on vielä tärkeää varmistaa, että kone saatetaan oikeaan herra-orja arkkitehtuuriverkkoon. Verkon voi tarkistaa VirtualBoxissa täältä: </br>
![Kuva2](https://user-images.githubusercontent.com/122887740/234657766-e8b1be30-5194-4dda-b674-b8934091df26.png) </br>
![Kuva3](https://user-images.githubusercontent.com/122887740/234657951-dccd7c91-75f1-45bd-911b-bd8760baced6.png) </br>

Kuvan korostettu verkko on tässä tapauksessa oikea, koska sen määritteet ovat samat, mitä määriteltiin kurssin alussa luotaessa herra-orja-arkkitehtuuria.
Kun verkko on tarkistettu, sammutetaan virtuaali Windows-kone, jotta päästään konfiguroimaan koneen asetuksia. Uusi verkko tulee konfiguroida Windows koneelle erilliselle verkkokortille, jonka saa täältä aktivoitua:</br>
![Kuva4](https://user-images.githubusercontent.com/122887740/234658940-177cff98-bcff-4f48-a775-9eb8bfc636f0.png) </br>
![Kuva5](https://user-images.githubusercontent.com/122887740/234659597-2f09b1d7-f30d-4299-827c-b8a606d867e8.png) </br>

Konfigurointien jälkeen voidaan käynnistää kone ja siirtyä seuraavaan tehtävään.


## a) Asenna Salt Windowsille
Klo 17:45</br>
Nyt oli aika asentaa Salt Windowsille, navigoin tulevalla Windows orja koneella Edgeä käyttäen osoitteeseen: ```https://docs.saltproject.io/en/3003/topics/installation/windows.html``` ja valkkasin sieltä  ```Python3 AMD64: Salt-Minion-3004.2-AMD64-Setup.exe```.
Latauksen jälkeen oli vuorossa asennus, joka meni seuraavanlaisesti: Hyväksy UAC -> paina Next -> I Agree -> Next -> syötä tarvittavat tiedot tähän kohtaan: </br>
![Kuva6](https://user-images.githubusercontent.com/122887740/234660070-72259e59-9162-4b35-a742-d3b9e5ee6a4f.png) </br>


Lopuksi klikkaa Install -> Yes -> Finish (loppu kohdassa voidaan valita Start Salt-minion tai käyttää delayed startia). Asennuksen jälkeen oli tarkoitus siirtyä Linux-herra koneelle tarkastamaan lähettikö Windows-orja Salt avaimet: </br>

![Kuva7](https://user-images.githubusercontent.com/122887740/234660602-b6d7d405-c727-480c-b990-a08d9b520a3f.png) </br>
Orja on kutsunut herraansa, vielä piti hyväksyä uusi orja remmiin komennolla: ```sudo salt-key -A```</br>

![Kuva8](https://user-images.githubusercontent.com/122887740/234660834-0640378c-9f8b-4c08-815f-05c73cd0edd8.png)

Windows-orja on nyt hyväksytty Linux-herra koneella.


## b) Ei voi kalastaa. Käytä Windowsilla Salttia paikallisesti ilman verkkoa (Ruma-X, powershell as admin, salt-call --local state.single ...)

## c) Hei ikkuna! Tee hei maailma Windowsin Saltille. Voit vaikkapa tehdä tyhjän tiedoston johonkin väliaikaistiedostojen kansioon.

## d) Installed. Asenna Windowsille ohjelma Saltilla. (Voit käyttää eri vaihtoehtoja: kopioida binäärin suoraan sopivaan kansioon, pkg.installed ja choco, pkg.installed ja salt winrepo).


## Lopetus
Lopetin tehtävien teon klo 17:41 kirjatumalla isäntäkoneen SSH-yhteydestä komennolla ```exit``` ja sammuttalla sekä isäntä että orja koneet komennolla ```vagrant halt```. Kyseinen tehtävä syvensi Saltin käytön eri vaihtoehtoja ja tehtävässä pääsi myös vähän soveltamaan uusiakin asioita. Töihin meni kokonaisuudessaan tällä erää n. 2h.

## Lähteet:
Karvinen, Tero, Infra as Code course, Palvelinten Hallinta 2023 kevät - (https://terokarvinen.com/2023/palvelinten-hallinta-2023-kevat/)
Karvinen, Tero, Control Windows with Salt, 18.4.2018 - (https://terokarvinen.com/2018/control-windows-with-salt/)
Seppänen, P, 26.11.2018, Harjoitus 5, Linux-master meets Windows-slave - (https://pseppanen296518693.wordpress.com/2018/11/26/harjoitus-5-linux-master-meets-windows-slave/)
Microsoft, 2023, Get a Windows 11 development environment - (https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/)
Saltstack, 4.10.2022, INSTALLATION FROM THE OFFICIAL SALTSTACK REPOSITORY - (https://docs.saltproject.io/en/3003/topics/installation/windows.html)
